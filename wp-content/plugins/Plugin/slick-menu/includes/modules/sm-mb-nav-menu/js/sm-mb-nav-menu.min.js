!function(e){"use strict";e.fn.mbNavMenu=function(a,s){var n={};return n.parent=SM_MB_NAV_MENU,n.trigger=e(this),n.settings=a,n.vars=s,n.id="sm-mb-nav-menu-"+(null!==n.settings.item_id?n.settings.item_id:"global-"+n.settings.menu_id),n.classes="sm-mb-nav-menu-edit sm-mb-nav-menu"+(null!==n.settings.item_id?n.settings.item_id:"-global"),n.exists=0!==e("#"+n.id).length,n.selector=".sm-mb-nav-menu-edit",n.has_changes=!1,n.load_errors=0,n.save_errors=0,n.exists?n.el=e("#"+n.id):(n.el=e("<div />"),n.el.attr("id",n.id),n.el.addClass(n.classes),n.el.data("reload",!1),n.el.data("has-loaded",!1),n.el.data("images",{})),n.init=function(){e.ajaxSetup({async:!0}),n.container=wp.customize?n.trigger.closest(".control-section-nav_menu"):e("body");e(window).height();if(n.close(),n.exists)n.el.data("reload")===!0?n.load(function(a){n.el.find(".sm-mb-nav-menu-content").html(e(a)),n.initEvents(),n.reloadImageFields(),n.loaded()}):(n.fixImageFields(),n.loaded());else{var a="";wp.customize&&(a+='<button class="customize-section-back" tabindex="0">',a+='\t<span class="screen-reader-text">Back</span>',a+="</button>"),n.el.html('<div class="sm-mb-nav-menu-header">'+a+'<span class="sm-mb-nav-menu-title"></span> <span class="sm-mb-nav-menu-type"></span></div><div class="sm-mb-nav-menu-content"></div>'),n.el.appendTo(n.container),n.load(function(a){var s="undefined"!=typeof n.settings.load_only&&n.settings.load_only;n.el.find(".sm-mb-nav-menu-content").html(e(a)),n.initEvents(),n.fixImageFields(),n.loaded(s)})}},n.initEvents=function(){var a=function(){n.has_changes=!0,n.el.addClass("sm-mb-unsaved"),e(this).closest(".sm-rwmb-field").addClass("sm-mb-unsaved"),e(n.el).trigger("sm_mb_nav_menu_has_changes",[e(this)]),e(document).trigger("sm_mb_nav_menu_has_changes",[e(this),n])};if(e("form .sm-rwmb-slider",n.el).on("slidechange",a),e("form input",n.el).on("change",a),wp.customize){var s=function(){var a=n.el.find('[name="'+n.field_id("menu-always-visible")+'"]:checked');"1"===a.val()?(n.el.find(".sm-mb-nav-menu-preview").hide(),e('[name="slick-menu-menu-always-visible"][value="1"]:checked').not(a).each(function(){e(this).closest("ul").find('[name="slick-menu-menu-always-visible"][value="0"]').trigger("click"),e(this).closest("form").find(".sm-mb-nav-menu-submit").data("silent",!0).trigger("click"),e(this).closest("form").find(".sm-mb-nav-menu-preview").show(),n.el.find(".sm-mb-nav-menu-submit").trigger("click")})):n.el.find(".sm-mb-nav-menu-preview").show()};e(n.el).on("sm_mb_nav_menu_saved",function(){s()}),s(),e(document).trigger("sm_mb_panel_rendered",[n])}var i=n.el.find('[name="slick-menu-level-animation-type"]:checked');if(i.length){var t=n.el.find("#slick-menu-menu-animation-type"),m=t.val();i.trigger("change"),t.val(m)}n.el.find(".sm-rwmb-group-wrapper .sm-rwmb-sort-clone:first-child").each(function(){var a=e(this).closest(".sm-rwmb-group-wrapper"),s=a.find(">.sm-rwmb-label"),n=a.find(">.sm-rwmb-input"),i=s.find(".sm-rwmb-sort");0===i.length&&(i=e('<a class="sm-rwmb-sort hide-if-no-js" href="#"><i class="dashicons dashicons-sort"></i>sort</a>'),s.append(i)),i.off("click"),i.on("click",function(){n.hasClass("sm-rwmb-sorting")?(i.removeClass("sm-rwmb-sorting"),n.removeClass("sm-rwmb-sorting")):(i.addClass("sm-rwmb-sorting"),n.addClass("sm-rwmb-sorting"))})});var l=function(){var a=e(this),s=a.closest(".sm-rwmb-input"),n=s.find(".sm-mb-animation-preview"),i=a.val();if(i=""===i?"no-animation":"sm-"+i,0===n.length)a.after('<span class="sm-mb-animation-preview sm-animated '+i+'" data-animation="'+i+'"></span>');else{var t=n.data("animation");n.removeClass(t),n.addClass(i),n.data("animation",i)}};n.el.on("change",".sm-mb-animate-field select",l).trigger("change");var d=function(a,s){e(a).is(":checked")?s.each(function(){e(this).attr("data-val")&&""!==e(this).attr("data-val")&&e(this).val(e(this).attr("data-val"))}):s.each(function(){""!==e(this).val()&&e(this).attr("data-val",e(this).val()).val("")})};setTimeout(function(){n.el.find('.sm-rwmb-group-wrapper > .sm-rwmb-input[data-id*="-transforms"]').find("#enabled").each(function(){var a=e(this).closest(".sm-rwmb-group-wrapper"),s=a.find(".sm-rwmb-slider-value");e(this).on("change",function(){d(this,s)}),e(this).is(":checked")||d(this,s)})},200),e("div.ipf").trigger("ipf:update"),e(document).trigger("sm_mb_init_events",{target:n.el}),e(window).trigger("resize")},n.load=function(a){e.ajax({url:ajaxurl,type:"post",dataType:"html",data:{action:"sm_mb_nav_menu_load",wpnonce:n.vars.editor_load_nonce,menu_id:n.settings.menu_id,item_id:n.settings.item_id,depth:n.settings.depth,customizer:wp.customize?1:0}}).done(function(e){"invalid nonce"===e?location.reload():a(e)}).fail(function(){n.load_errors++,n.load_errors<3?n.load(a):location.reload()})},n.loaded=function(a){a=!("undefined"==typeof a||!a),n.el.find(".sm-mb-nav-menu-header .sm-mb-nav-menu-title").html(n.settings.title),n.el.find(".sm-mb-nav-menu-header .sm-mb-nav-menu-type").html(n.settings.type),!a||n.el.data("has-loaded")?(n.el.addClass("loaded"),e("body").removeClass("sm-mb-nav-menu-inactive"),e("body").addClass("sm-mb-nav-menu-active"),wp.customize&&e(".wp-full-overlay-sidebar-content").scrollTop(0)):wp.customize&&!n.parent.SlickMenu.isOpen(n.settings.menu_id)&&n.parent.SlickMenu.open(n.settings.menu_id),n.trigger.removeClass("loading").addClass("loaded").closest(".menu-item").addClass("sm-mb-active"),n.mp_enabled=Boolean(parseInt(n.el.find('input[name="mp_enabled"]').val())),1===n.el.find(".sm-mb-metabox-holder").length&&n.el.find(".sm-mb-metabox-holder").first().addClass("sm-mb-active"),wp.customize&&e(".wp-customizer.sm-mb-nav-menu-active #menu-to-edit").scrollTop(0),n.el.data("reload",!1),n.el.data("has-loaded",!0)},n.save=function(a){var s=n.el.find("form"),i=s.serialize();e.ajax({url:ajaxurl,type:"POST",data:i,dataType:"json"}).done(function(e){"invalid nonce"===e?location.reload():a(e)}).fail(function(){n.save_errors++,n.save_errors<3?n.save(a):location.reload()})},n.resetField=function(a,s,i){var t,m=function(a,s){if(a.hasClass("sm-rwmb-media-input")&&a.parent().find(".sm-rwmb-remove-media").trigger("click"),a.is(":checkbox"))1===s?a.attr("checked",!0):a.attr("checked",!1);else if(a.is(":radio"))""!==s?a.filter('[value="'+s+'"]').attr("checked",!0):a.attr("checked",!1);else if(a.val(s),a.hasClass("ipf-icon")){var n=a.closest(".ipf");n.trigger("ipf:update")}else a.hasClass("sm-rwmb-rgba")?a.trigger("keyup"):a.hasClass("sm-rwmb-slider-value")?a.parent().find(".sm-rwmb-slider").slider("value",s):a.hasClass("sm-rwmb-autocomplete")&&a.parent().find(".sm-rwmb-autocomplete-result .actions").each(function(){e(this).trigger("click")});a.trigger("change"),a.closest(".sm-rwmb-field").removeClass("slick-menu-highlight").addClass("slick-menu-highlight")};if("object"===i){var l,d=0;for(var r in s)l=n.el.find('input[name="'+a+"["+r+']"]'),n.resetField(l,s[r],"string"),d++;0==d&&n.resetField(!1,"","string")}else a!==!1&&("object"==typeof a?t=a:(t=n.el.find('input[name="'+a+'"]'),0===t.length&&(t=n.el.find("#"+a))),m(t,s))},n.showLoading=function(){n.el.find("form").addClass("loading"),n.el.find("form + .sm-mb-nav-menu-loading").addClass("sm-mb-visible")},n.hideLoading=function(){n.el.find("form").removeClass("loading"),n.el.find("form + .sm-mb-nav-menu-loading").removeClass("sm-mb-visible")},n.close=function(){e(n.selector).find(".sm-mb-metabox-wrap.sm-mb-active").removeClass("sm-mb-active").find(".sm-mb-metabox-holder.sm-mb-active").removeClass("sm-mb-active"),e(n.selector).removeClass("loaded"),e(".menu-item").removeClass("sm-mb-active"),e("body").addClass("sm-mb-nav-menu-inactive"),e("body").removeClass("sm-mb-nav-menu-active")},n.fixImageFields=function(){n.el.find(".sm-rwmb-image_advanced").each(function(){var a=e(this),s=a.closest(".sm-rwmb-input"),i=a.val(),t=e(".sm-mb-nav-menu-edit").not(n.el).find('.sm-rwmb-image_advanced[value="'+i+'"]').first();if(t.length>0){var m=t.closest(".sm-rwmb-input");s.replaceWith(m)}})},n.saveImageFields=function(){var a,s,i,t=n.el.data("images");t&&(n.el.find(".sm-rwmb-image_advanced").each(function(){a=e(this),s=a.closest(".sm-rwmb-field"),i=a.attr("name"),"undefined"!=typeof t[i]&&(t[i]=s.detach())}),n.el.data("images",t))},n.reloadImageFields=function(){var a,s,i,t=n.el.data("images");t&&n.el.find(".sm-rwmb-image_advanced").each(function(){a=e(this),s=a.closest(".sm-rwmb-field"),i=a.attr("name"),"undefined"!=typeof t[i]&&s.replaceWith(e(t[i]))})},n.field_id=function(e){return SM_VARS.field_prefix+e},"close"===a?n.close():n.init(),n}}(jQuery);