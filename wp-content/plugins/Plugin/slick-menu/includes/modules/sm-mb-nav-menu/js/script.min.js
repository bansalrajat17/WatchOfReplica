!function(e,n){"use strict";var t={},i={_init:!1,vars:SM_MB_NAV_MENU_VARS,ajax_errors:0,customizer:{iframe:null,iframeDoc:null,iframeLoaded:!1},init:function(){this._init||(n.ajaxSetup({async:!0}),n("html").addClass("sm-wp-version-"+this.vars.wp_version),this.vars.wp_version>"4-6-1"&&n("html").addClass("sm-wp-version-ge-4-7"),this.initEvents(),this._init=!0)},customizerFrameLoaded:function(){var e=this;e.customizer.iframe=n(wp.customize.previewer.container).find("iframe"),e.customizer.iframeDoc=n(e.customizer.iframe.contents()),e.customizer.iframeLoaded=!0,e.SlickMenu=e.customizer.iframe[0].contentWindow.SlickMenu;var t="dashicons-css",i=n("#"+t),a=e.customizer.iframeDoc.find("head").find("#"+t);0===a.length&&i.length>0&&(a=i.clone(),a.appendTo(e.customizer.iframeDoc.find("head"))),e.customizer.iframeDoc.off("sm-loaded sm-reloaded"),e.customizer.iframeDoc.on("sm-loaded sm-reloaded",function(n){e.slickMenuReloaded(n.detail.menu_id)}),e.openCustomizerMenuEditor()},getCustomizerVars:function(){return this.customizer},slickMenuReloaded:function(e){var t=this;t.refreshVars(function(){var i=t.SlickMenu.get(e);i=t.customizer.iframeDoc.find("#"+n(i).attr("id")),n(i).find('.sm-nav-list li:not(.menu-item-has-children) > a:not([class*="sm-trigger-"]), .slick-menu-widgets-wrap a').off(),n(i).find('.sm-nav-list li:not(.menu-item-has-children) > a:not([class*="sm-trigger-"]), .slick-menu-widgets-wrap a').on("click",function(e){var i=n(this),a=i.attr("href"),m=!1;if("#"===a.charAt(0)&&a.length>1&&n(a,t.customizer.iframeDoc).length>0&&(m=!0),""!==a&&!m){e.preventDefault(),n(wp.customize.previewer.container).removeClass("iframe-ready");var s=i.get(0).href;wp.customize.previewer.previewUrl(s),t.refreshVars()}})})},refreshVars:function(e){var t=this;if(wp&&"undefined"!=typeof wp&&"undefined"!=typeof wp.customize&&"undefined"!=typeof wp.customize.previewer)var i=setInterval(function(){wp.customize?n(wp.customize.previewer.container).hasClass("iframe-ready")&&(clearInterval(i),t.customizerFrameLoaded(),"undefined"!=typeof e&&e()):clearInterval(i)},10)},openCustomizerMenuEditor:function(){var e=this;if(e.busy)return!1;e.busy=!0;var t=setInterval(function(){var i=n("#menu-to-edit").find(".sm-mb-nav-menu-metabox-div");if(0===i.length){var a=n("#menu-to-edit .customize-control-nav_menu_name");if(0!==a.length){var m=a.attr("id");if(m.search("--")===-1){e.busy=!1;var s=n('<li class="customize-control"><div class="sm-mb-nav-menu-loading sm-mb-visible"></div></li>').insertAfter(a),o=parseInt(a.attr("id").match(/\d+/)[0]);e.renderMetabox(o,function(t){s.html(n(t)),e.initTrigger(),e.initMetaboxEvents()})}}}else e.busy=!1,e.initTrigger();e.busy||clearInterval(t)},300)},initEvents:function(){var e=this;"undefined"!=typeof wp&&"undefined"!=typeof wp.customize?e.refreshVars(function(){n(".control-section-nav_menu h3").on("click",function(){e.openCustomizerMenuEditor()}),setTimeout(function(){n(document).on("DOMNodeInserted",function(t){"menu-to-edit"===t.relatedNode.id&&"LI"===t.target.nodeName&&n(t.target).hasClass("menu-item")&&!n(t.target).hasClass("sm-mb-nav-menu-loaded")&&e.insertTrigger(n(t.target))})},2e3);var t=function(){setTimeout(function(){e.refreshVars(function(){var t;if(t=n("#menu-to-edit .sm-mb-nav-menu-preview").length>0?n("#menu-to-edit .sm-mb-nav-menu-preview").data("id"):e.SlickMenu.getOpen())if(e.SlickMenu.isCreated(t))e.SlickMenu.reload(t);else{var i=e.customizer.iframeDoc.find("#sm-menu-"+t);0===i.length||0===n("#menu-to-edit .menu-item").length?wp.customize.previewer.refresh():e.SlickMenu.reload(t)}})},1e3)};n("#save").off("click",t),n("#save").on("click",t);var i=e.getQueryParam(location.href,"menu");if(i){var a=n("#accordion-section-nav_menu\\["+i+"\\] h3");a.length&&a.click()}}):(e.initMetaboxEvents(),e.initTrigger(),n(document).ajaxComplete(function(){setTimeout(function(){e.initTrigger()},1e3)})),n(document).on("click",function(e){n(e.target).parent().hasClass("sm-rwmb-label")&&(e.preventDefault(),e.stopPropagation())})},initMetaboxEvents:function(){var e=this,i=function(t){t.preventDefault();var i=n(this),a=n(t.target).closest("#sm-mb-nav-menu-metabox-div");if(i.hasClass("loading"))return!1;a.html('<div class="sm-mb-nav-menu-loading sm-mb-visible"></div>');var m=i.data("id");e.menuActivation(m,1,function(t){i.removeClass("loading");var m=n(t);"undefined"==typeof wp.customize&&m.find(".sm-mb-preview-row").remove(),a.replaceWith(m),e.initMetaboxEvents(),wp.customize&&wp.customize.previewer.refresh()})},a=function(t){t.preventDefault();var i=n(this),a=n(t.target).closest("#sm-mb-nav-menu-metabox-div");if(i.hasClass("loading"))return!1;a.html('<div class="sm-mb-nav-menu-loading sm-mb-visible"></div>');var m=i.data("id");e.menuActivation(m,0,function(t){i.removeClass("loading"),a.replaceWith(n(t)),e.initMetaboxEvents(),wp.customize&&wp.customize.previewer.refresh()})},m=function(i){if(i.preventDefault(),n(this).hasClass("loading"))return!1;n(this).addClass("loading");var a=0,m="",s=n(this).html(),o=n(this).data("id"),r=n(this).mbNavMenu({type:m,menu_id:o,item_id:null,title:s,depth:a,load_only:!0},e.vars);t[r.id]=r},s=function(t){t.preventDefault();var i=n(this);e.refreshVars(function(){var n=i.data("id");e.SlickMenu.isCreated(n)?e.SlickMenu.toggle(n):e.SlickMenu.reload(n)})};n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-enable, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-enable").off("click",i),n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-enable, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-enable").on("click",i),n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-disable, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-disable").off("click",a),n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-disable, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-disable").on("click",a),n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch").off("click",m),n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch").on("click",m),setTimeout(function(){n(".nav-menus-php #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch, #menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch").trigger("click")},50),wp.customize?(n("#menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-preview").off("click"),n("#menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-preview").on("click",s)):n(".nav-menus-php #sm-mb-nav-menu-metabox-div").find(".sm-mb-preview-row").remove(),e.initPluginMetaboxes()},initTrigger:function(){var e=this;n("#menu-to-edit li.menu-item:not(.sm-mb-nav-menu-loaded)").each(function(){var t=n(this);e.insertTrigger(t)})},insertTrigger:function(e){var i=this;e.addClass("sm-mb-nav-menu-loaded");var a;wp.customize?wp.customize.section.each(function(e){e.expanded()&&(a=e.params.menu_id)}):a=n("input#menu").val();var m=e.find(".menu-item-title").text(),s=e.find(".item-type").text();m||(m=e.find(".item-title").text());var o=parseInt(e.attr("id").match(/[0-9]+/)[0],10),r='<span class="sm-spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></span>'+i.vars.title,u=n("<span>").addClass("sm-mb-nav-menu-launch").html(r).on("click",function(r){if(r.preventDefault(),n(this).hasClass("loading"))return!1;n(this).addClass("loading");var u=e.attr("class").match(/\menu-item-depth-(\d+)\b/)[1],c=n(this).mbNavMenu({type:s,menu_id:a,item_id:o,title:m,depth:u},i.vars);t[c.id]=c});wp.customize?n(".menu-item-bar",e).append(u):n(".item-title",e).append(u)},renderMetabox:function(e,t){var i=this;n.ajax({url:ajaxurl,type:"post",dataType:"html",data:{action:"sm_mb_nav_menu_metabox",wpnonce:SM_MB_NAV_MENU_VARS.metabox_nonce,id:e}}).done(function(e){"invalid nonce"===e?location.reload():t(e)}).fail(function(){i.ajax_errors++,i.ajax_errors<3?i.renderMetabox(e,t):location.reload()})},menuActivation:function(e,t,i){var a=this;n.ajax({url:ajaxurl,type:"post",dataType:"html",data:{action:"sm_mb_nav_menu_activation",wpnonce:SM_MB_NAV_MENU_VARS.activation_nonce,flag:t,id:e},statusCode:{502:function(){a.ajax_errors++,a.ajax_errors<3?a.menuActivation(e,t,i):location.reload()}}}).done(function(e){"invalid nonce"===e?location.reload():(n(document).trigger("sm_mb_metabox_rendered"),i(e))}).fail(function(){a.ajax_errors++,a.ajax_errors<3?a.menuActivation(e,t,i):location.reload()})},initPluginMetaboxes:function(){wp.customize||n("#menu-settings-column ul").find('li[class*="sm-metabox-"]').each(function(){n(this).insertAfter(n("#slick-menu-metabox-nav-menu-global"))}),n("#sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-launch").length>0?(n("body").addClass("slick-menu-active"),wp.customize||n("#menu-settings-column ul").find('li[class*="sm-metabox-"]').slideDown()):(n("body").removeClass("slick-menu-active"),wp.customize||n("#menu-settings-column ul").find('li[class*="sm-metabox-"]').slideUp())},updateQueryParam:function(e,n,t){if(!e)return!1;var i=new RegExp("([?&])"+n+"=.*?(&|$)","i"),a=e.indexOf("?")!==-1?"&":"?";return e.match(i)?e.replace(i,"$1"+n+"="+t+"$2"):e+a+n+"="+t},getQueryParam:function(e,n){if(!e)return!1;n=n.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=t.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}},a={_init:!1,classname:"sm-mb-nav-menu-edit",selector:function(e){return"."+this.classname+" "+e},panelEl:function(){return n("."+this.classname)},activePanelEl:function(){return n("."+this.classname+".loaded")},activePanel:function(){var e=this.activePanelEl();return e.length>0?t[e.attr("id")]:null},init:function(){this._init||(this.initEvents(),this._init=!0)},initEvents:function(){var t=this;n(e).on("resize",function(){setTimeout(function(){t.activePanelEl().length>0&&t.activePanelEl().find(".sm-mb-metabox-holder.sm-mb-active .sm-mb-metabox-title").each(function(){var e=n(this),t=e.closest(".sm-mb-metabox-holder"),i=t.outerWidth(!0);e.css("width",i+1+"px")})},2)}),n(document).on("click",t.selector(".sm-mb-metabox-title"),function(){var e=n(this),t=e.closest(".sm-mb-metabox-wrap"),i=e.closest(".sm-mb-metabox-holder"),a=i.outerWidth(!0);i.hasClass("sm-mb-active")?(i.removeClass("sm-mb-active"),t.removeClass("sm-mb-active"),e.css("width","")):(i.addClass("sm-mb-active"),t.addClass("sm-mb-active"),e.css("width",a+1+"px"),t.scrollTop(0))}),n(document).on("click",t.selector(".sm-mb-nav-menu-submit"),function(e){e.preventDefault();var i=t.activePanel(),a=t.activePanelEl();if(null===i)return!1;var m=n(this),s=m.closest("form"),o=s.find('input[name="menu_id"]').val(),r=m.data("silent")===!0;return!s.hasClass("submitting")&&(m.text(m.data("saving")),s.addClass("submitting"),i.has_changes=!1,a.removeClass("sm-mb-unsaved"),a.find("sm-mb-unsaved").each(function(){n(this).removeClass("sm-mb-unsaved")}),t.showLoading(),wp.customize&&wp.customize.previewer.save(),void i.save(function(e){setTimeout(function(){m.text(m.data("saved")).blur(),wp.customize&&(i.mp_enabled?i.parent.refreshVars(function(){var e="slick-menu-dynamic-"+o+"-css",n=i.parent.customizer.iframeDoc.find("head").find("#"+e),t=n.attr("href"),a=parseInt(i.parent.SlickMenu.getOption(o,"menu-close-duration"));setTimeout(function(){t&&t.length>0&&n.attr("href",i.parent.updateQueryParam(t,"t",Date.now()))},a),i.parent.SlickMenu.reload(o,function(){i.parent.slickMenuReloaded(o),m.removeData("silent")},r)}):wp.customize.previewer.refresh()),t.hideLoading(),setTimeout(function(){s.removeClass("submitting"),m.text(m.data("submitting"))},2e3),a.trigger("sm_mb_nav_menu_saved",[e]),n(document).trigger("sm_mb_nav_menu_saved",[a,e])},1e3)}))}),n(document).on("click",t.selector(".sm-mb-nav-menu-preview"),function(e){e.preventDefault(),n("#menu-to-edit #sm-mb-nav-menu-metabox-div .sm-mb-nav-menu-preview").trigger("click")}),n(document).on("click",t.selector(".sm-mb-nav-menu-reset"),function(e){e.preventDefault();var i=t.activePanel(),a=t.activePanelEl();if(null===i)return!1;var m=confirm(SM_VARS.lang.reset_all_confirm);if(m!==!0)return!1;var s=a.find("form");t.showLoading(),setTimeout(function(){s.find(".slick-menu-reset-field").each(function(e){n(this).trigger("click")})},200),setTimeout(function(){a.trigger("sm_mb_nav_menu_save"),t.hideLoading()},1e3)}),n(document).on("click",t.selector(".slick-menu-reset-group"),function(e){e.preventDefault();var i=t.activePanel(),a=t.activePanelEl();if(null===i)return!1;var m=n(this).closest(".sm-rwmb-group-wrapper"),s=m.find(" > .sm-rwmb-label label").html(),o=SM_VARS.lang.reset_group_confirm.replace("{group_name}",s),r=confirm(o);if(r!==!0)return!1;t.showLoading(),setTimeout(function(){m.find(".slick-menu-reset-field").each(function(e){n(this).trigger("click")})},200),setTimeout(function(){a.trigger("sm_mb_nav_menu_save"),t.hideLoading()},1e3)}),n(document).on("click",t.selector(".slick-menu-reset-field"),function(e){e.preventDefault();var i=t.activePanel(),a=t.activePanelEl();if(null===i)return!1;var m=n(this);t.showLoading();var s=m.closest("form"),o=m.data("std"),r=m.data("type"),u=m.data("id"),c=m.closest(".sm-rwmb-group-wrapper"),l=c.length,d=u;l&&(d=c.find(">.sm-rwmb-input").data("id")+"["+d+"]");var v,f=s.find('input[name="target_item"]').val();v="1"===f?s.find('input[name="item_id"]').val():s.find('input[name="menu_id"]').val(),u=u.replace(SM_VARS.field_prefix,""),i.resetField(d,o,r),setTimeout(function(){a.trigger("sm_mb_nav_menu_save"),t.hideLoading()},500)}),n(document).on("sm_mb_nav_menu_save",t.selector(""),function(){n(this).find(".sm-mb-nav-menu-submit").trigger("click")}),wp.customize?(n(document).on("click","#menu-to-edit .customize-section-back",function(){n.fn.mbNavMenu("close")}),n(document).on("click",t.selector(".customize-section-back"),function(e){e.preventDefault(),n.fn.mbNavMenu("close")})):n(document).on("click","#wpcontent",function(e){n(e.target).hasClass("sm-mb-nav-menu-launch")||(n("#wpcontent").off("click"),n.fn.mbNavMenu("close"))}),n(document).on("click",t.selector("form#sm-mb-nav-menu-metaboxes .submit .sm-mb-nav-menu-back"),function(e){e.preventDefault(),n.fn.mbNavMenu("close")});var i=function(e,t){n(e.target).find(".ipf").each(function(){var e=n(this),t=e.find(".ipf-icon");t.val(""),e.trigger("ipf:update")}),n(e.target).find(".sm-rwmb-rgba").trigger("clone")};n(document).on("clone_instance",t.selector(".sm-rwmb-clone"),i);var a=function(){var e=t.activePanel(),n=t.activePanelEl();e&&(e.saveImageFields(),n.data("reload",!0))};n(document).on("sm_mb_metabox_rendered",a)},showLoading:function(){this.activePanel().showLoading()},hideLoading:function(){this.activePanel().hideLoading()}};n(document).ready(function(){i.init(),a.init()}),setTimeout(function(){i.init(),a.init()},2e3),e.SM_MB_NAV_MENU=i,e.SM_MB_NAV_PANEL=a,e.SM_MB_NAV_PANELS=t}(window,jQuery);